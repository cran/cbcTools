<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Computing D-error in Choice Experiments</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>







<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Computing D-error in Choice
Experiments</h1>



<div id="what-is-d-error" class="section level2">
<h2>What is D-error?</h2>
<p>D-error is a measure of how good or bad a design is at extracting
information from respondents in a choice experiment. A design with a
<strong>low D-error</strong> is better than a design with a <strong>high
D-error</strong>, provided that both designs are for the same
experiment. Comparing D-error between designs for different experiments
is meaningless.</p>
<p>When generating designs using D-optimal methods in
<code>cbc_design()</code>, several of the methods
(<code>&quot;stochastic&quot;</code>, <code>&quot;modfed&quot;</code>, <code>&quot;cea&quot;</code>)
use an algorithm that minimizes D-error to find efficient experimental
designs. The specific type of D-error computed depends on the prior
assumptions you provide.</p>
<blockquote>
<p>Note: A “D-optimal” design is not necessarily the best design for
your experiment. These designs optimize information about the “main
effects” of interest, at the expence of information about interactions.
If you feel interactions may be important, consider using a different
design method or consider including interactions in your priors.</p>
</blockquote>
</div>
<div id="types-of-d-error" class="section level2">
<h2>Types of D-error</h2>
<div id="prior-parameter-assumptions" class="section level3">
<h3>Prior Parameter Assumptions</h3>
<p>When computing D-error, a prior assumption about the respondent
parameters needs to be made:</p>
<ul>
<li><span class="math inline">\(D_0\)</span>-error assumes that all
parameters are zero — i.e., respondents have no preference for any of
the attribute levels</li>
<li><span class="math inline">\(D_p\)</span>-error assumes that all
respondent parameters are equal to a fixed parameter vector<br />
</li>
<li><span class="math inline">\(D_B\)</span>-error assumes that
respondent parameters are distributed according to a probability
distribution (typically multivariate normal)</li>
</ul>
</div>
<div id="how-cbctools-chooses-d-error-type" class="section level3">
<h3>How cbcTools Chooses D-error Type</h3>
<p>In <code>cbc_design()</code> with D-optimal methods
(<code>&quot;stochastic&quot;</code>, <code>&quot;modfed&quot;</code>, <code>&quot;cea&quot;</code>),
the type of D-error minimized depends on your prior specifications:</p>
<ol style="list-style-type: decimal">
<li><strong>No priors provided</strong> (<code>priors = NULL</code>) →
Uses <span class="math inline">\(D_0\)</span>-error</li>
<li><strong>Fixed parameters</strong> (using <code>cbc_priors()</code>
with fixed values) → Uses <span class="math inline">\(D_p\)</span>-error</li>
<li><strong>Random parameters</strong> (using <code>cbc_priors()</code>
with <code>rand_spec()</code>) → Uses <span class="math inline">\(D_B\)</span>-error</li>
</ol>
</div>
</div>
<div id="working-example" class="section level2">
<h2>Working Example</h2>
<p>Let’s work through the mathematical steps of D-error computation
using the same example from the literature.</p>
<div id="the-design" class="section level3">
<h3>The Design</h3>
<p>Consider this simple 3-attribute, 2-alternative choice
experiment:</p>
<table>
<colgroup>
<col width="11%" />
<col width="7%" />
<col width="12%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th>Version</th>
<th>Task</th>
<th>Question</th>
<th>Alternative</th>
<th>Attribute 1</th>
<th>Attribute 2</th>
<th>Attribute 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="even">
<td>1</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>3</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
<div id="step-1-encode-the-design" class="section level3">
<h3>Step 1: Encode the Design</h3>
<p>The first step is to encode the design using dummy coding. For each
2-level attribute, we create one dummy variable (comparing level 2
vs. level 1 as reference). This gives us:</p>
<p><strong>Question 1:</strong> <span class="math display">\[X_1 =
\begin{pmatrix}
0 &amp; 1 &amp; 0 \\
1 &amp; 0 &amp; 1
\end{pmatrix}\]</span></p>
<p><strong>Question 2:</strong> <span class="math display">\[X_2 =
\begin{pmatrix}
0 &amp; 1 &amp; 1 \\
1 &amp; 0 &amp; 0
\end{pmatrix}\]</span></p>
<p><strong>Question 3:</strong> <span class="math display">\[X_3 =
\begin{pmatrix}
1 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{pmatrix}\]</span></p>
</div>
</div>
<div id="computing-d_p-error-fixed-parameters" class="section level2">
<h2>Computing <span class="math inline">\(D_p\)</span>-error (Fixed
Parameters)</h2>
<p>For <span class="math inline">\(D_p\)</span>-error, we assume
specific parameter values: <span class="math inline">\(\boldsymbol{\beta} = [0.5, -0.5,
0.8]\)</span>.</p>
<div id="step-2-compute-choice-probabilities" class="section level3">
<h3>Step 2: Compute Choice Probabilities</h3>
<p>Using the multinomial logit formula:</p>
<p><span class="math display">\[P_{iq} = \frac{\exp(X_{iq}
\boldsymbol{\beta})}{\sum_{j=1}^{J} \exp(X_{jq}
\boldsymbol{\beta})}\]</span></p>
<p>For Question 1: - Utility Alt1: <span class="math inline">\(U_1 = 0
\times 0.5 + 1 \times (-0.5) + 0 \times 0.8 = -0.5\)</span> - Utility
Alt2: <span class="math inline">\(U_2 = 1 \times 0.5 + 0 \times (-0.5) +
1 \times 0.8 = 1.3\)</span> - <span class="math inline">\(P_{11} =
\frac{e^{-0.5}}{e^{-0.5} + e^{1.3}} = 0.143\)</span> - <span class="math inline">\(P_{21} = \frac{e^{1.3}}{e^{-0.5} + e^{1.3}} =
0.857\)</span></p>
<p>Similar calculations for Questions 2 and 3 give us the choice
probabilities for each alternative in each question.</p>
</div>
<div id="step-3-compute-fisher-information-matrix" class="section level3">
<h3>Step 3: Compute Fisher Information Matrix</h3>
<p>The Fisher information matrix for each choice set uses the
formula:</p>
<p><span class="math display">\[I_q = X_q^T \left(
\text{diag}(\mathbf{P_q}) - \mathbf{P_q} \mathbf{P_q}^T \right)
X_q\]</span></p>
<p>where <span class="math inline">\(\mathbf{P_q}\)</span> is the vector
of choice probabilities for choice set <span class="math inline">\(q\)</span>, and <span class="math inline">\(\text{diag}(\mathbf{P_q})\)</span> creates a
diagonal matrix from this vector.</p>
<p>The total information matrix is: <span class="math display">\[I =
\sum_{q=1}^{Q} I_q\]</span></p>
</div>
<div id="step-4-compute-d_p-error" class="section level3">
<h3>Step 4: Compute <span class="math inline">\(D_p\)</span>-error</h3>
<p>The <span class="math inline">\(D_p\)</span>-error is calculated
as:</p>
<p><span class="math display">\[D_p\text{-error} =
(\det(I))^{-1/K}\]</span></p>
<p>where <span class="math inline">\(K = 3\)</span> is the number of
parameters.</p>
</div>
</div>
<div id="computing-d_0-error-no-priors" class="section level2">
<h2>Computing <span class="math inline">\(D_0\)</span>-error (No
Priors)</h2>
<p><span class="math inline">\(D_0\)</span>-error is a special case
where <span class="math inline">\(\boldsymbol{\beta} = [0, 0,
0]\)</span>, making all alternatives equally likely.</p>
<p>When all parameters are zero: - All utilities = 0 - All choice
probabilities = <span class="math inline">\(\frac{1}{J}\)</span> where
<span class="math inline">\(J\)</span> is the number of alternatives</p>
<p>For our 2-alternative case: <span class="math inline">\(P_{iq} =
0.5\)</span> for all alternatives.</p>
<p>The information matrix calculation follows the same formula, but with
equal probabilities. This simplifies the calculation considerably
since:</p>
<p><span class="math display">\[\text{diag}(\mathbf{P_q}) - \mathbf{P_q}
\mathbf{P_q}^T = \text{diag}(0.5, 0.5) - \begin{pmatrix} 0.25 &amp; 0.25
\\ 0.25 &amp; 0.25 \end{pmatrix} = \begin{pmatrix} 0.25 &amp; -0.25 \\
-0.25 &amp; 0.25 \end{pmatrix}\]</span></p>
</div>
<div id="computing-d_b-error-random-parameters" class="section level2">
<h2>Computing <span class="math inline">\(D_B\)</span>-error (Random
Parameters)</h2>
<p><span class="math inline">\(D_B\)</span>-error assumes parameters
follow a probability distribution. For example, if we assume:</p>
<p><span class="math display">\[\boldsymbol{\beta} \sim N\left([0.5,
-0.5, 0.8], \text{diag}([0.5^2, 0.5^2, 0.5^2])\right)\]</span></p>
<p>The computation involves:</p>
<ol style="list-style-type: decimal">
<li><strong>Draw parameter samples</strong> from the distribution (e.g.,
<span class="math inline">\(R = 1000\)</span> draws)</li>
<li><strong>Compute <span class="math inline">\(D_p\)</span>-error</strong> for each parameter
draw <span class="math inline">\(\boldsymbol{\beta}^{(r)}\)</span></li>
<li><strong>Average the results</strong> to get <span class="math inline">\(D_B\)</span>-error</li>
</ol>
<p><span class="math display">\[D_B\text{-error} = \frac{1}{R}
\sum_{r=1}^{R} D_p\text{-error}(\boldsymbol{\beta}^{(r)})\]</span></p>
<table>
<thead>
<tr class="header">
<th>Draw</th>
<th>Parameter 1</th>
<th>Parameter 2</th>
<th>Parameter 3</th>
<th><span class="math inline">\(D_p\)</span>-error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0.25</td>
<td>-0.73</td>
<td>0.67</td>
<td>1.45</td>
</tr>
<tr class="even">
<td>2</td>
<td>1.14</td>
<td>-0.67</td>
<td>0.67</td>
<td>1.90</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0.69</td>
<td>-0.50</td>
<td>1.23</td>
<td>1.92</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>1000</td>
<td>1.15</td>
<td>-1.67</td>
<td>0.57</td>
<td>2.82</td>
</tr>
</tbody>
</table>
<p><strong><span class="math inline">\(D_B\)</span>-error = mean of all
<span class="math inline">\(D_p\)</span>-errors = 1.90</strong></p>
<hr />
<blockquote>
<p>Note: The example used in this article is inspired by <a href="https://www.displayr.com/how-to-compute-d-error-for-a-choice-experiment/">this
article</a> on displayr.com.</p>
</blockquote>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
